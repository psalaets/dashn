#!/usr/bin/env node

var catstream = require('catstream');
var dashn = require('..');

var args = process.argv.slice();
args.shift(); // discard node :(
args.shift(); // discard script name

if (args[0] === '-e') args.shift(); // discard unused flag

var expression = args.slice(0, 1);
var filenames = args.slice(1);

var cat = catstream();

cat.pipe(dashn(makeWriteFunction(expression)));
cat.end(filenames.join('\n'));

function makeWriteFunction(expression) {
  var body =
    "var log = console.log.bind(console);" +
    "var error = console.error.bind(console);" +
    "var line = data.toString();" +
    expression;
  return new Function('data', body);
}
